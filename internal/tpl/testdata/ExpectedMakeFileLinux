version=0.0.0
ifndef p
$(error Platform is not passed. p argument expected)
endif
# Create folder for build artifacts
DIR := $(dir $(abspath $(lastword $(MAKEFILE_LIST))))
BASE := $(notdir $(patsubst %/,%,$(DIR)))
MTR_DIR := $(DIR)$(BASE)
# Determine OS cores
NPROCS = $(shell grep -c 'processor' /proc/cpuinfo)
MAKEFLAGS += -j$(NPROCS)
# List of all the recipes to be executed during the build process
.PHONY: ui meta mtar cleanup
# Default target compile all
all: tdir validate ui meta mtar cleanup
# Create folder for build artifacts
tdir:
	@mkdir -p "$(MTR_DIR)"
# Validate mta.yaml
validate:
	@mbt validate -d=dev
# Set the current project repository path for general mta process
  PROJ_DIR := $(CURDIR)

# List of modules
modules = ui

# Execute all modules builds
# build module ui
ui:
	@cd $(PROJ_DIR)/ui && grunt
# Pack module build artifacts
	@mbt module pack -m=ui -p=${p}


# Create META-INF folder with MANIFEST.MF & mtad.yaml
meta:
	@mbt gen meta -d=dev -p=${p}

# Pack as MTAR artifact
mtar: $(modules) meta
	@mbt gen mtar -d=dev

cleanup: mtar
# Remove tmp folder
	@mbt cleanup
